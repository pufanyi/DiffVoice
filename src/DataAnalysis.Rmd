---
title: "Data Analysis"
knit: (function(inputFile, encoding) {
      out_dir <- "../docs/";
      rmarkdown::render(inputFile,
                        encoding=encoding,
                        output_dir=file.path(dirname(inputFile), out_dir))})
output:
  html_document:
    theme: journal
    toc: true
    toc_float: true
---

## Load Data

```{r}
data_path = "../data/train.csv"
data = read.csv(data_path)
head(data)
```

## Centroid

We firstly load the data and draw a histogram of the `centroid` column.

```{r}
centroid = data$centroid
hist(centroid)
```

Then, we calculate the mean and standard deviation of the `centroid` column.

```{r}
centroid_mean <- mean(centroid)
centroid_sd <- sd(centroid)
print(paste("Mean of centroid:", centroid_mean))
print(paste("Standard deviation of centroid:", centroid_sd))
```

#### Histogram with overlaid normal curve

```{r}
hist(centroid, probability = TRUE, main = "Histogram of Centroid with Normal Curve", xlab = "Centroid")
curve(dnorm(x, mean = centroid_mean, sd = centroid_sd), col = "darkblue", lwd = 2, add = TRUE, yaxt = "n")
```

#### QQ plot

```{r}
qqnorm(centroid, main = "QQ Plot of Centroid")
qqline(centroid, col = "steelblue", lwd = 2)
```

### Log-transformed `centroid`

```{r}
centroid_log <- log(centroid)
hist(centroid_log, breaks = 20, main = "Histogram of log(centroid)", xlab = "log(centroid)")
centroid_log_mean <- mean(centroid_log)
centroid_log_sd <- sd(centroid_log)
print(paste("Mean of log-transformed centroid:", centroid_log_mean))
print(paste("Standard deviation of log-transformed centroid:", centroid_log_sd))
```

#### Histogram with overlaid normal curve

```{r}
hist(centroid_log, probability = TRUE, main = "Histogram of log-transformed Centroid with Normal Curve", xlab = "log(centroid)")
curve(dnorm(x, mean = centroid_log_mean, sd = centroid_log_sd), col = "darkblue", lwd = 2, add = TRUE, yaxt = "n")
```

#### QQ plot for log-transformed `centroid`

```{r}
qqnorm(centroid_log, main = "QQ Plot for log-transformed centroid")
qqline(centroid_log, col = "red")
```

### Removing Outliers

```{r}
outliers <- !(centroid_log > (centroid_log_mean - 3 * centroid_log_sd) & centroid_log < (centroid_log_mean + 3 * centroid_log_sd))
outlier_ids <- data.frame(id = data$id[outliers])
centroid_log_no_outliers <- centroid_log[!outliers]
```

Then, we save the IDs of the outliers to a CSV file.

```{r}
write.csv(outlier_ids, "../data/outliers/centroid.csv", row.names = FALSE)
```

Then, we draw the histogram and QQ plot for the log-transformed `centroid` column without the outliers.

```{r}
hist(centroid_log_no_outliers, breaks = 20, main = "Histogram of log-transformed Centroid without Outliers", xlab = "log(centroid)")
centroid_log_no_outliers_mean <- mean(centroid_log_no_outliers)
centroid_log_no_outliers_sd <- sd(centroid_log_no_outliers)
print(paste("Mean of log-transformed centroid without outliers:", centroid_log_no_outliers_mean))
print(paste("Standard deviation of log-transformed centroid without outliers:", centroid_log_no_outliers_sd))
```

```{r}
hist(centroid_log_no_outliers, probability = TRUE, main = "Histogram of log-transformed Centroid without Outliers with Normal Curve", xlab = "log(centroid)", breaks = 20)
curve(dnorm(x, mean = centroid_log_no_outliers_mean, sd = centroid_log_no_outliers_sd), col = "darkblue", lwd = 2, add = TRUE, yaxt = "n")
```

```{r}
qqnorm(centroid_log_no_outliers, main = "QQ Plot for log-transformed centroid without outliers")
qqline(centroid_log_no_outliers, col = "red")
```

## MeanFun

```{r}
meanfun = data$meanfun
hist(meanfun)
```

Then, we calculate the mean and standard deviation of the `meanfun` column.

```{r}
meanfun_mean <- mean(meanfun)
meanfun_sd <- sd(meanfun)
```

It is very obvious that the `meanfun` column is not normally distributed, we can see that from the histogram and QQ plot below.

```{r}
hist(meanfun, probability = TRUE, main = "Histogram of MeanFun with Normal Curve", xlab = "MeanFun", breaks = 20)
curve(dnorm(x, mean = meanfun_mean, sd = meanfun_sd), col = "darkblue", lwd = 2, add = TRUE, yaxt = "n")
```

```{r}
qqnorm(meanfun, main = "QQ Plot of MeanFun")
qqline(meanfun, col = "steelblue", lwd = 2)
```

### Log-transformed `meanfun`

```{r}
meanfun_log <- log(meanfun)
hist(meanfun_log, breaks = 20, main = "Histogram of log(meanfun)", xlab = "log(meanfun)")
```

```{r}
meanfun_log_mean <- mean(meanfun_log)
meanfun_log_sd <- sd(meanfun_log)
print(paste("Mean of log-transformed meanfun:", meanfun_log_mean))
print(paste("Standard deviation of log-transformed meanfun:", meanfun_log_sd))
```

```{r}
hist(meanfun_log, probability = TRUE, main = "Histogram of log-transformed MeanFun with Normal Curve", xlab = "log(meanfun)", breaks = 20)
curve(dnorm(x, mean = meanfun_log_mean, sd = meanfun_log_sd), col = "darkblue", lwd = 2, add = TRUE, yaxt = "n")
```

```{r}
qqnorm(meanfun_log, main = "QQ Plot for log-transformed meanfun")
qqline(meanfun_log, col = "red")
```

### Removing Outliers

```{r}
outliers <- !(meanfun_log > (meanfun_log_mean - 3 * meanfun_log_sd) & meanfun_log < (meanfun_log_mean + 3 * meanfun_log_sd))
outlier_ids <- data.frame(id = data$id[outliers])
meanfun_log_no_outliers <- meanfun_log[!outliers]
```

Then, we save the IDs of the outliers to a CSV file.

```{r}
write.csv(outlier_ids, "../data/outliers/meanfun.csv", row.names = FALSE)
```

Then, we draw the histogram and QQ plot for the log-transformed `meanfun` column without the outliers.

```{r}
hist(meanfun_log_no_outliers, breaks = 20, main = "Histogram of log-transformed MeanFun without Outliers", xlab = "log(meanfun)")
meanfun_log_no_outliers_mean <- mean(meanfun_log_no_outliers)
meanfun_log_no_outliers_sd <- sd(meanfun_log_no_outliers)
print(paste("Mean of log-transformed meanfun without outliers:", meanfun_log_no_outliers_mean))
print(paste("Standard deviation of log-transformed meanfun without outliers:", meanfun_log_no_outliers_sd))
```

```{r}
hist(meanfun_log_no_outliers, probability = TRUE, main = "Histogram of log-transformed MeanFun without Outliers with Normal Curve", xlab = "log(meanfun)", breaks = 20)
curve(dnorm(x, mean = meanfun_log_no_outliers_mean, sd = meanfun_log_no_outliers_sd), col = "darkblue", lwd = 2, add = TRUE, yaxt = "n")
```

```{r}
qqnorm(meanfun_log_no_outliers, main = "QQ Plot for log-transformed meanfun without outliers")
qqline(meanfun_log_no_outliers, col = "red")
```

